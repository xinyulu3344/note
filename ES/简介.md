## 搜索引擎

### 搜索引擎需要具备的要求

- 查询速度快
  - 高效的压缩算法
  - 快速的编码和解码速度
- 结果准确
  - BM25评分算法（es7及以后）
  - TF-IDF算法（es7之前）
- 检索结果丰富
  - 召回率

## Elastic Stack（ELK Stack）

| Server        | 作用                                                  |
| ------------- | ----------------------------------------------------- |
| Elasticsearch | 基于Json的分布式搜索和分析引擎，是Elastic Stack的核心 |
| Logstash      | 动态数据收集管道，生态丰富                            |
| Kibana        | 提供数据的可视化界面                                  |
| Beats         | 轻量级的数据采集器                                    |

## 特点

- 开源、免费：基于Apache License 2.0开源协议，并且完全免费。
- 基于Java语言：Elasticsearch基于Java语言开发，运行在Jvm环境中。
- 基于Lucene框架∶基于开源的Apache Lucene框架开发。
- 原生分布式：不依赖与Zookeeper，自带分布式解决方案。
- 高性能：支持海量数据的全文检索。支持PB级数据秒内响应!对于ES来说，上亿级别数据只不过是起点!性能几乎没有上限，足以满足各种对性能要求极高的场景。
- 可伸缩：弹性搜索，可根据不同规模服务对性能需要的不同而动态扩展或收缩性能。
- 易扩展：支持非常方便的横向扩展集群。
- 开箱即用∶对于小公司，解压后零配置启动服务即可立即使用，门槛极低
- 跨编程语言：支持Java、Golang、Python、C#、PHP等多种变成语言，几乎所有语言开发者都可以使用Elasticsearch。

## 应用场景

- 搜索引擎
- 各大电商平台
- 导航、打车、外卖软件
- 音视频软件
- GitHub
- ELK日志系统
- 站内搜索等

## ES支持的搜索类型

- 结构化搜索
- 非结构化搜索
- 文本搜索
- 地理位置搜索

## 擅长与不擅长

ES最擅长从海量数据中检索少量相关数据，但不擅长单次查询大量数据

## 写入实时性

ES是OLAP系统，侧重于海量数据的检索，而写入实时性并不是很高，默认1秒，也就是ES缓冲区Buffer的刷新间隔时间，不了解Elasticsearch写入原理的同学可以暂时忽略。ES并非忽略了对写入性能的优化，而是“有意为之”，其原因就在于基于ES的写入机制，其写入实时性和大数据检索性能是一个二选一的行为。实际上生产环境中我们经常通过“牺牲写入实时性”的操作来换取更高更快的“数据检索”性能。

## 不支持事务

正因为ES的写入实时性并不高，如果我们需要快速响应用户请求，我们常采取的手段就是使用缓存，但是在很多高并发的场景下，我们需要数据保持强一致性（如银行系统），因此需要使用具有ACID特性的数据库来支持，而MySQL就是一个比较好的选择。

## 极限的性能

PB级别数据秒内响应

## 常见DB的对比

|                  | Elasticsearch                        | Solr                                                       | MongoDB                        | MySQL                        |
| ---------------- | ------------------------------------ | ---------------------------------------------------------- | ------------------------------ | ---------------------------- |
| DB类型           | 搜索引擎                             | 搜索引擎                                                   | 文档数据库                     | 关系型数据库                 |
| 基于何种框架开发 | Lucene                               | Lucene                                                     |                                |                              |
| 基于何种开发语言 | Java                                 | Java                                                       | C++                            | C、C++                       |
| 数据结构         | FST、Hash等                          |                                                            |                                | B+树                         |
| 数据格式         | Json                                 | Json/XML/CSV                                               | Json                           | Row                          |
| 分布式支持       | 原生支持                             | 支持                                                       | 原生支持                       | 不支持                       |
| 数据分区方案     | 分片                                 | 分片                                                       | 分片                           | 分库分表                     |
| 业务系统类型     | OLAP                                 | OLAP                                                       | OLTP                           | OLTP                         |
| 事务支持         | 不支持                               | 不支持                                                     | 多文档ACID事务                 | 支持                         |
| 数据量级         | PB级                                 | TB-PB级                                                    | PB级                           | 单库3000w                    |
| 一致性策略       | 最终一致性                           | 最终一致性                                                 | 最终一致性、即时一致性         | 即时一致性                   |
| 擅长领域         | 海量数据全文检索<br />大数据聚合分析 | 大数据全文检索                                             | 海量数据CRUD                   | 强一致性<br />ACID<br />事务 |
| 劣势             | 不支持事务<br />写入实时性低         | 海量数据性能不如ES<br />随着数据量的不断增大，稳定性低于ES | 弱事务支持<br />不支持join查询 | 大数据全文搜索性能低         |
| 查询性能         | ⭐️⭐️⭐️⭐️⭐️                                | ⭐️⭐️⭐️⭐️                                                       | ⭐️⭐️⭐️⭐️⭐️                          | ⭐️⭐️⭐️                          |
| 写入性能         | ⭐️⭐️                                   | ⭐️⭐️                                                         | ⭐️⭐️⭐️⭐️                           | ⭐️⭐️⭐️                          |

